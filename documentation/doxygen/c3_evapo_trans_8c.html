<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>BioCro: /home/dlebauer/dev/biocro/src/c3EvapoTrans.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">BioCro
   &#160;<span id="projectnumber">0.92</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('c3_evapo_trans_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">c3EvapoTrans.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;R.h&gt;</code><br/>
<code>#include &lt;Rmath.h&gt;</code><br/>
<code>#include &lt;Rinternals.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="">c3photo.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="">AuxBioCro.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="">c3EvapoTrans.h</a>&quot;</code><br/>
</div><div class="textblock"><div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Include dependency graph for c3EvapoTrans.c:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="c3_evapo_trans_8c__incl.png" border="0" usemap="#_2home_2dlebauer_2dev_2biocro_2src_2c3_evapo_trans_8c" alt=""/></div>
<map name="_2home_2dlebauer_2dev_2biocro_2src_2c3_evapo_trans_8c" id="_2home_2dlebauer_2dev_2biocro_2src_2c3_evapo_trans_8c">
<area shape="rect" id="node5" href="c3photo_8h.html" title="c3photo.h" alt="" coords="285,96,363,123"/><area shape="rect" id="node6" href="_aux_bio_cro_8h.html" title="AuxBioCro.h" alt="" coords="388,96,484,123"/><area shape="rect" id="node7" href="c3_evapo_trans_8h.html" title="c3EvapoTrans.h" alt="" coords="508,96,624,123"/></map>
</div>
</div>
<p><a href="">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aba1996fef3ada8e38076ed028b74a912"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="struct_e_t___str.html">ET_Str</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="c3_evapo_trans_8c.html#aba1996fef3ada8e38076ed028b74a912">c3EvapoTrans</a> (double Rad, double Itot, double Airtemperature, double RH, double WindSpeed, double LeafAreaIndex, double CanopyHeight, double vcmax2, double jmax2, double Rd2, double b02, double b12, double Catm2, double O2, double theta2, double StomWS, int ws)</td></tr>
<tr class="separator:aba1996fef3ada8e38076ed028b74a912"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="aba1996fef3ada8e38076ed028b74a912"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="struct_e_t___str.html">ET_Str</a> c3EvapoTrans </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>Rad</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>Itot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>Airtemperature</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>RH</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>WindSpeed</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>LeafAreaIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>CanopyHeight</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>vcmax2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>jmax2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>Rd2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>b02</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>b12</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>Catm2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>O2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>theta2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>StomWS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ws</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;{</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        <span class="comment">/* creating the structure to return */</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;        <span class="keyword">struct </span><a class="code" href="struct_e_t___str.html">ET_Str</a> tmp;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;        <span class="keyword">struct </span><a class="code" href="structc3__str.html">c3_str</a> tmpc3;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> LeafWidth = 0.04;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> kappa = 0.41;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> WindSpeedHeight = 5;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> dCoef = 0.77;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> tau = 0.2;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> ZetaCoef = 0.026;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> ZetaMCoef = 0.13;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> LeafReflectance = 0.2;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> SpecificHeat = 1010;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        <span class="keywordtype">double</span> Tair, WindSpeedTopCanopy;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        <span class="keywordtype">double</span> DdryA, LHV, SlopeFS, SWVC;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        <span class="keywordtype">double</span> LayerRelativeHumidity, LayerWindSpeed, totalradiation;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        <span class="keywordtype">double</span> LayerConductance, DeltaPVa, PsycParam, ga;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        <span class="keywordtype">double</span> BoundaryLayerThickness, DiffCoef,LeafboundaryLayer;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        <span class="keywordtype">double</span> d, Zeta, Zetam, ga0, ga1, ga2; </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        <span class="keywordtype">double</span> Ja, Deltat;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        <span class="keywordtype">double</span> PhiN;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        <span class="keywordtype">double</span> TopValue, BottomValue;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        <span class="keywordtype">double</span> EPen, TransR,EPries; </div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        <span class="keywordtype">double</span> OldDeltaT, rlc, ChangeInLeafTemp; </div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        <span class="keywordtype">int</span> Counter;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        WindSpeedTopCanopy = WindSpeed;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        Tair = Airtemperature;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        <span class="keywordflow">if</span>(CanopyHeight &lt; 0.1)</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                CanopyHeight = 0.1; </div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        DdryA = <a class="code" href="_aux_bio_cro_8c.html#aef4a29370ba3b33794837905d82f3b86">TempToDdryA</a>(Tair) ;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        LHV = <a class="code" href="_aux_bio_cro_8c.html#abea4623ebab0e4ea7d9be5af1fd80344">TempToLHV</a>(Tair) * 1e6 ; </div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <span class="comment">/* Here LHV is given in MJ kg-1 and this needs to be converted</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">           to Joules kg-1  */</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        SlopeFS = <a class="code" href="_aux_bio_cro_8c.html#abd35797ea11e52f0c527d40a9c1c0b7d">TempToSFS</a>(Tair) * 1e-3;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        SWVC = <a class="code" href="_aux_bio_cro_8c.html#a2b62fa0d37af87f9af219e7b0d56f34d">TempToSWVC</a>(Tair) * 1e-3;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        <span class="comment">/* FIRST CALCULATIONS*/</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        Zeta = ZetaCoef * CanopyHeight;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        Zetam = ZetaMCoef * CanopyHeight;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        d = dCoef * CanopyHeight;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="comment">/* Relative Humidity is giving me a headache */</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        <span class="comment">/* RH2 = RH * 1e2; A high value of RH makes the </span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">           difference of temperature between the leaf and the air huge.</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">           This is what is causing the large difference in DeltaT at the </span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">           bottom of the canopy. I think it is very likely.  */</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        LayerRelativeHumidity = RH * 100;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        <span class="keywordflow">if</span>(LayerRelativeHumidity &gt; 100) </div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                error(<span class="stringliteral">&quot;LayerRelativehumidity &gt; 100&quot;</span>); </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        <span class="keywordflow">if</span>(WindSpeed &lt; 0.5) WindSpeed = 0.5;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        LayerWindSpeed = WindSpeed;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        <span class="comment">/*&#39; Convert light assuming 1 Âµmol PAR photons = 0.235 J/s Watts*/</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        totalradiation = Itot * 0.235;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        tmpc3 = <a class="code" href="c3photo_8c.html#ad30b1a99fb440301345822cb38fb5cbe">c3photoC</a>(Rad,Airtemperature,RH,vcmax2,jmax2,Rd2,b02,b12,Catm2,O2,theta2,StomWS,ws); </div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        LayerConductance = tmpc3.Gs;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        <span class="comment">/* Convert mmoles/m2/s to moles/m2/s</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">           LayerConductance = LayerConductance * 1e-3</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">           Convert moles/m2/s to mm/s</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">           LayerConductance = LayerConductance * 24.39</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">           Convert mm/s to m/s</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">           LayerConductance = LayerConductance * 1e-3 */</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        LayerConductance = LayerConductance * 1e-6 * 24.39;  </div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <span class="comment">/* Thornley and Johnson use m s^-1 on page 418 */</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="comment">/* prevent errors due to extremely low Layer conductance */</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        <span class="keywordflow">if</span>(LayerConductance &lt;=0)</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                LayerConductance = 0.01;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <span class="keywordflow">if</span>(SWVC &lt; 0)</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                error(<span class="stringliteral">&quot;SWVC &lt; 0&quot;</span>);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="comment">/* Now RHprof returns relative humidity in the 0-1 range */</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        DeltaPVa = SWVC * (1 - LayerRelativeHumidity / 100);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        PsycParam =(DdryA * SpecificHeat) / LHV;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        <span class="comment">/* Ja = (2 * totalradiation * ((1 - LeafReflectance - tau) / (1 - tau))) * LeafAreaIndex; */</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <span class="comment">/* It seems that it is not correct to multiply by the leaf area index. Thornley</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">           and johnson pg. 400 suggest using (1-exp(-k*LAI) but note that for a full canopy</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">           this is 1. so I&#39;m using 1 as an approximation. */</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        Ja = (2 * totalradiation * ((1 - LeafReflectance - tau) / (1 - tau)));</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <span class="comment">/* Calculation of ga */</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        <span class="comment">/* According to thornley and Johnson pg. 416 */</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        ga0 = pow(kappa,2) * LayerWindSpeed;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        ga1 = log((WindSpeedHeight + Zeta - d)/Zeta);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        ga2 = log((WindSpeedHeight + Zetam - d)/Zetam);</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        ga = ga0/(ga1*ga2);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <span class="comment">/*  Rprintf(&quot;ga: %.5f \n&quot;, ga); */</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <span class="keywordflow">if</span>(ga &lt; 0)</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                error(<span class="stringliteral">&quot;ga is less than zero&quot;</span>);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        DiffCoef = (2.126 * 1e-5) + ((1.48 * 1e-7) * Airtemperature);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        BoundaryLayerThickness = 0.004 * sqrt(LeafWidth / LayerWindSpeed);</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        LeafboundaryLayer = DiffCoef / BoundaryLayerThickness;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <span class="comment">/* Temperature of the leaf according to Campbell and Norman (1998) Chp 4.*/</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="comment">/* This version is non-iterative and an approximation*/</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <span class="comment">/* Stefan-Boltzmann law: B = sigma * T^4. where sigma is the Boltzmann</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">           constant: 5.67 * 1e-8 W m^-2 K^-4. */</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="comment">/* From Table A.3 in the book we know that*/</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <span class="comment">/*  rlc = (4 * (5.67*1e-8) * pow(273 + Airtemperature, 3) * Deltat) * LeafAreaIndex;   */</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <span class="comment">/*  PhiN = Ja - rlc; */</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <span class="comment">/*  dd = 0.72 * LeafWidth; */</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <span class="comment">/*  gHa = 1.4 * 0.135 * sqrt(LayerWindSpeed * 0.72 * LeafWidth);  */</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <span class="comment">/*  gva = 1.4 * 0.147 * sqrt(LayerWindSpeed * 0.72 * LeafWidth);  */</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <span class="comment">/*  TopValue = Ja - (SWVC/7.28) * 5.67*1e-8 * pow(Airtemperature + 273.15,4) - LHV * LayerConductance * 1e-3 * DeltaPVa / 101.3; */</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="comment">/* Here I divide SWVC by 7.28 to approximately change from g/m3 to kPa */</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <span class="comment">/* I&#39;m also multiplying Layer conductance by 1e-3 since it should be in mol m^-2 s^-1 */</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        <span class="comment">/*  BottomValue = SpecificHeat * gHr + LHV * SlopeFS * LayerConductance * 1e-3;  */</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <span class="comment">/*  Deltat = Airtemperature + TopValue/BottomValue; */</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <span class="comment">/*  PhiN = TopValue; */</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        <span class="comment">/* This is the original from WIMOVAC*/</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        Deltat = 0.01;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        ChangeInLeafTemp = 10;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        Counter = 0;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <span class="keywordflow">while</span>( (ChangeInLeafTemp &gt; 0.5) &amp;&amp; (Counter &lt;= 10))</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        {</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                OldDeltaT = Deltat;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                <span class="comment">/*         rlc = (4 * (5.67*1e-8) * pow(273 + Airtemperature, 3) * Deltat) * LeafAreaIndex;   */</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                rlc = (4 * (5.67*1e-8) * pow(273 + Airtemperature, 3) * Deltat);  </div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                PhiN = (Ja - rlc);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                TopValue = PhiN * (1 / ga + 1 / LayerConductance) - LHV * DeltaPVa;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                BottomValue = LHV * (SlopeFS + PsycParam * (1 + ga / LayerConductance));</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                Deltat = TopValue / BottomValue;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                <span class="keywordflow">if</span>(Deltat &gt; 5)  Deltat = 5;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                <span class="keywordflow">if</span>(Deltat &lt; -5) Deltat = -5;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                ChangeInLeafTemp = OldDeltaT - Deltat;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                <span class="keywordflow">if</span>(ChangeInLeafTemp &lt;0)</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                        ChangeInLeafTemp = -ChangeInLeafTemp;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                Counter++;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        }</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="keywordflow">if</span>(PhiN &lt; 0)</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                PhiN = 0;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        TransR = (SlopeFS * PhiN + (LHV * PsycParam * ga * DeltaPVa)) / (LHV * (SlopeFS + PsycParam * (1 + ga / LayerConductance)));</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        EPries = 1.26 * ((SlopeFS * PhiN) / (LHV * (SlopeFS + PsycParam)));</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        EPen = (((SlopeFS * PhiN) + LHV * PsycParam * ga * DeltaPVa)) / (LHV * (SlopeFS + PsycParam));</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="comment">/* This values need to be converted from Kg/m2/s to</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment">           mmol H20 /m2/s according to S Humphries */</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="comment">/*res[1,1] = EPen * 10e6 / 18;*/</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <span class="comment">/*res[1,2] = EPries * 10e6 / 18;*/</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <span class="comment">/* 1e3 - kgrams to grams  */</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <span class="comment">/* 1e3 - mols to mmols */</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <span class="comment">/*  res[0] = ((TransR * 1e3) / 18) * 1e3 ; */</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="comment">/*  res[1] = Deltat; */</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <span class="comment">/*  res[2] = LayerConductance; */</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="comment">/* Let us return the structure now */</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        tmp.TransR = TransR * 1e6 / 18; </div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        tmp.EPenman = EPen * 1e6 / 18; </div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        tmp.EPriestly = EPries * 1e6 / 18; </div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        tmp.Deltat = Deltat;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        tmp.LayerCond = LayerConductance * 1e6 * (1/24.39);   </div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <span class="comment">/*    tmp.LayerCond = RH2;   */</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <span class="comment">/*   tmp.LayerCond = 0.7; */</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        <span class="keywordflow">return</span>(tmp);</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;}</div>
<div class="ttc" id="c3photo_8c_html_ad30b1a99fb440301345822cb38fb5cbe"><div class="ttname"><a href="c3photo_8c.html#ad30b1a99fb440301345822cb38fb5cbe">c3photoC</a></div><div class="ttdeci">struct c3_str c3photoC(double Qp, double Tleaf, double RH, double Vcmax0, double Jmax, double Rd0, double bb0, double bb1, double Ca, double O2, double thet, double StomWS, int ws)</div><div class="ttdef"><b>Definition:</b> c3photo.c:119</div></div>
<div class="ttc" id="_aux_bio_cro_8c_html_aef4a29370ba3b33794837905d82f3b86"><div class="ttname"><a href="_aux_bio_cro_8c.html#aef4a29370ba3b33794837905d82f3b86">TempToDdryA</a></div><div class="ttdeci">double TempToDdryA(double Temp)</div><div class="ttdef"><b>Definition:</b> AuxBioCro.c:179</div></div>
<div class="ttc" id="_aux_bio_cro_8c_html_abd35797ea11e52f0c527d40a9c1c0b7d"><div class="ttname"><a href="_aux_bio_cro_8c.html#abd35797ea11e52f0c527d40a9c1c0b7d">TempToSFS</a></div><div class="ttdeci">double TempToSFS(double Temp)</div><div class="ttdef"><b>Definition:</b> AuxBioCro.c:193</div></div>
<div class="ttc" id="_aux_bio_cro_8c_html_a2b62fa0d37af87f9af219e7b0d56f34d"><div class="ttname"><a href="_aux_bio_cro_8c.html#a2b62fa0d37af87f9af219e7b0d56f34d">TempToSWVC</a></div><div class="ttdeci">double TempToSWVC(double Temp)</div><div class="ttdef"><b>Definition:</b> AuxBioCro.c:200</div></div>
<div class="ttc" id="structc3__str_html"><div class="ttname"><a href="structc3__str.html">c3_str</a></div><div class="ttdef"><b>Definition:</b> c3photo.h:8</div></div>
<div class="ttc" id="_aux_bio_cro_8c_html_abea4623ebab0e4ea7d9be5af1fd80344"><div class="ttname"><a href="_aux_bio_cro_8c.html#abea4623ebab0e4ea7d9be5af1fd80344">TempToLHV</a></div><div class="ttdeci">double TempToLHV(double Temp)</div><div class="ttdef"><b>Definition:</b> AuxBioCro.c:186</div></div>
<div class="ttc" id="struct_e_t___str_html"><div class="ttname"><a href="struct_e_t___str.html">ET_Str</a></div><div class="ttdef"><b>Definition:</b> AuxBioCro.h:32</div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="c3_evapo_trans_8c.html">c3EvapoTrans.c</a></li>
    <li class="footer">Generated on Fri Apr 3 2015 15:41:06 for BioCro by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
